# 32单片机学习记录10之通用定时器

## 前置

**STM32F407，通用定时器是基本定时器的进化版吧？我看通用定时器内部框图其中包含了基本定时器的框图。**
**那么在配置通用定时器时，是不是遵守用什么功能配置对应的寄存器？因为通用定时器相关的寄存器太多了？**

是的，STM32F407的通用定时器（General Purpose Timer）可以看作是基本定时器的一个进化版。通用定时器提供了更多的功能和更复杂的控制机制。以下是几个关键点：

1. **功能包含**：通用定时器确实包含了基本定时器的所有功能，但同时还增加了很多高级功能，如：
   - 输入捕获
   - 输出比较
   - PWM（脉宽调制）生成
     - **通用定时器通过输出比较功能来实现PWM信号的生成，所以可以说PWM是输出比较功能的一种应用形式。**
   - 计数器模式（向上、向下或中心对齐模式）
2. **配置寄存器**：在配置通用定时器时，你需要根据你要实现的功能来选择和设置相应的寄存器。这确实是因为通用定时器的功能多，相关的寄存器也很多。以下是一些主要的配置步骤：
   - **时钟源选择**：配置定时器的时钟源（如内部时钟、外部时钟等）。
   - **计数器模式**：选择计数器是向上计数、向下计数还是中心对齐模式。
   - **预分频器**：设置预分频器来调整定时器的计数频率。
   - **自动重装载值**：设置计数器的最大值。
   - **捕获/比较寄存器**：如果使用输入捕获或输出比较功能，需要配置这些寄存器。
   - **中断和DMA**：配置中断或DMA传输以便在特定事件发生时进行处理。
3. **功能与寄存器对应**：
   - 例如，如果你要配置PWM模式，你会需要设置ARR（自动重装载寄存器），CCRx（捕获/比较寄存器），以及相应的CCMRx（捕获/比较模式寄存器）来控制PWM的占空比和频率。
   - 如果是输入捕获模式，你需要配置CCER（捕获/比较使能寄存器）来启用捕获功能，并可能需要设置CCMRx来选择捕获模式。
     - 输入捕获的最常用应用形式之一是**测量脉冲宽度**或**测量信号频率**。具体来说：
       - **测量脉冲宽度**：通过捕获信号的上升沿和下降沿时间，可以计算出脉冲的宽度。这在需要精确控制或测量脉冲信号的系统中非常有用，例如在遥控系统中测量接收到的信号脉宽。
       - **测量信号频率**：通过捕获信号的多个周期的上升沿或下降沿，可以计算出信号的频率。这在频率计、转速测量（如用在电机控制系统中）等应用中非常常见。
4. **使用工具**：由于配置过程较为复杂，建议使用**STM32CubeMX**这样的工具来生成初始化代码，这样可以大大简化配置过程。该工具可以根据你选择的功能自动配置相关的寄存器。

总之，配置通用定时器时，确实需要根据所需功能选择和配置相应的寄存器，但通过了解每个寄存器的功能和使用正确的工具，可以有效地管理和配置这些复杂的定时器。

## 通用定时器的介绍

### 主要应用场景

- 延时和定时中断 （包含了基本定时器的所有功能）

- 输出比较(驱动IO口输出PWM )   

- 输入捕获(定时器计算IO口高低电平的时间) 

### STM32F4通用定时器的分布和各自特点

**TIM2到TIM5**           

特点：

1. 有四个通道，可用于
   1. 输入捕获
   2. 输出比较
   3. PWM 生成（边沿和中心对齐模式）
   4. 单脉冲模式输出
2. 通用定时器包含一个 16 位或 32 位自动重载计数器16 位（TIM3 和 TIM4）32 位（TIM2 和 TIM5）递增、递减和递增/递减自动重载计数器。
3. 16 位可编程预分频器
4. 输入捕获和输出比较
5. 编码器使用



**TIM9和TIM12**        

特点：

1. 两个通道（**还是可以使用上面的四种，只是通道少两个，不能同时使用而已**）
   1. **看框图就知道了**
2. 通用定时器包含一个 16位 自动重载计数器,递增计数器。
3. 16 位可编程预分频器
4. 输入捕获和输出比较



**TIM10，TIM11,TIM13,TIM14**  

特点：

1. 一个通道
2. 通用定时器包含一个 16 自动重载计数器递增计数器。
3. 16 位可编程预分频器
4. 输入捕获和输出比较

## 通用定时器框图

### 通用定时器框图结构

- 时钟源选择部分

- 基本定时器部分

- 输出比较部分

- 输入捕获部分

![image-20241213194226439](./32单片机学习记录10之通用定时器.assets/image-20241213194226439.png)

#### 通道功能的理解

**这四个通道只是可以用作四个功能的输入输出通道吧？同一时间：时钟频率还是只能输入一个有效值，还有周期也只能输入一个吧？只是在这种前提下，这四个通道可以实现的功能吧？比如周期不变但是占空比不同的PWM波形？**

- **单一时钟源**：每个定时器（如TIM2到TIM5）使用单一的时钟源，这意味着**所有四个通道共享同一个时钟频率**。你不能为每个通道独立设置不同的时钟频率。
- **周期**：定时器的周期由自动重装载寄存器（ARR）决定，这意味着**所有四个通道共享同一个周期**。你不能为每个通道设置不同的周期。
- **功能的多样性**：**虽然时钟频率和周期是固定的，但是每个通道的功能是独立的**，因此：
  - **输入捕获**：四个通道可以同时捕获不同的外部信号。
  - **输出比较**：四个通道可以独立地进行输出比较操作。
  - **PWM生成**：在同一个周期内，四个通道可以输出具有不同占空比的PWM信号。你可以独立地设置每个通道的比较寄存器（CCRx）值来调整每个PWM信号的占空比。

**具体到PWM生成：**

- 你可以**设置定时器的ARR值来决定PWM的周期。**
- 然后通过**设置每个通道的CCR值来独立地调整每个通道的占空比**。例如：
  - CH1的CCR1值决定了它的占空比。
  - CH2的CCR2值决定了它的占空比。
  - CH3的CCR3值决定了它的占空比。
  - CH4的CCR4值决定了它的占空比。

所以，**虽然定时器的时钟频率和周期是固定的，但每个通道可以实现不同的功能和参数设置**，这使得你可以在同一时间内输出周期相同但占空比不同的PWM波形。这正是通用定时器的灵活性所在。

### 时钟源选择部分

#### 时钟源部分

**有三种时钟来源，但是具体支持几种，看芯片手册描述**

**TIM2~TIM5**

**内部时钟源：**

- 信号源来自于哪里
  - APBX总线

- 如何选择本时钟源：
  - SMCR寄存器的SMS  000

**外部时钟模式1**

- 信号源具体来自于哪里

  - ITRX(定时器级联)
    - 定时器又接着一个定时器
    - 级联的作用，不断的可以分频，分到一个很慢的速度
    - 如何配置级联（级联表）

  - TI1F_ED(输入捕获的通道1接口进入**不经过滤波**)

  - TI1FP1(输入捕获的通道1接口进入经过滤波)

  - TI2FP2(输入捕获的通道2接口进入经过滤波)
    - ETRF(外部时钟模式2的接口进入)
      - **还有单独的这个模式的入口**

  - 说明：如何选择以上某一个信号源  SMCR寄存器的TS位	

- 如何选择本时钟源
  - SMCR寄存器的SMS  111

​	

**外部时钟模式2**

- 信号源来自于哪里
  - 片外接入（时钟脉冲设备）

- 如何选择本时钟源
  - SMCR寄存器的 ECE位 写入1

- 经过：
  - 变沿选择  分频  滤波

**特别提示：通常情况建议用内部时钟，不用外部时钟**

- **稳定性和精度**：内部时钟更稳定，不易受外部干扰。
- **同步**：与系统其他部分同步，避免同步问题。
- **便捷性**：无需额外硬件配置，简化设计。
- **资源管理**：不占用额外引脚，优化资源使用。

然而，**也有使用外部时钟的场景**：

- **特定频率需求**：当应用需要一个特定频率而内部时钟无法提供或调整到时。
- **外部同步**：如果需要与外部设备或系统同步，外部时钟可以提供这种同步的可能性。
- **特殊应用**：某些应用，如频率测量或信号生成，可能需要外部时钟提供更高精度的计时或特定的时钟源。

 

**TIM9 / TIM12**

- 时钟源：
  - 同TIM2 ~ TIM5  但是没有外部时钟模式2
  - 看芯片手册的相关描述和内部框图

**TIM10 TIM11 TIM13 TIM14**

- 时钟源：
  - 只能用内部时钟源（APBx）

### 基本定时器部分

​		完全符合基本定时规则，里面就是包含了一个基本定时器

### 输出比较部分

**输出比较**是STM32F407通用定时器的一个关键功能，通过比较定时器计数器的值与预设的比较值来控制输出信号的状态。以下是输出比较的几个主要应用场景：

1. **PWM（脉宽调制）生成**：
   - **应用场景**：PWM广泛应用于电机控制、LED调光、电源管理等领域。
   - **实现**：通过设置比较寄存器的值，可以调整PWM信号的占空比。每个定时器通道可以独立地产生PWM信号，从而可以实现多路PWM输出。例如，可以控制多个LED的亮度或多个电机的速度。
2. **单脉冲模式**：
   - **应用场景**：用于触发事件或产生单个脉冲，如激光器触发、摄像头快门控制等。
   - **实现**：设置定时器在计数器值达到比较值时产生一个脉冲，然后定时器自动停止。
3. **定时输出**：
   - **应用场景**：定时控制输出信号状态，如定时开关继电器、定时打开/关闭设备等。
   - **实现**：当计数器值与比较值相等时，改变输出信号的状态。
4. **波形生成**：
   - **应用场景**：用于产生复杂的波形，如正弦波、方波等，用于音频信号生成、信号测试等。
   - **实现**：通过快速调整比较值来模拟所需的波形。
5. **电机控制**：
   - **应用场景**：用于无刷直流电机（BLDC）或步进电机的控制。
   - **实现**：通过PWM信号调节电机转速和扭矩，输出比较可以用于生成必要的控制信号。
6. **数字信号处理**：
   - **应用场景**：在一些需要精确控制信号的数字信号处理应用中。
   - **实现**：通过输出比较可以实现信号的精确控制，如在数字音频合成中生成特定频率的音调。

使用输出比较的优势：

- **灵活性**：每个通道可以独立配置，允许多种信号生成。
- **精确控制**：输出比较提供精确的时间控制。
- **多功能性**：不仅限于PWM，还可以实现各种输出控制模式。

注意事项：

- **时钟频率**：选择合适的时钟频率来确保定时器的分辨率和精度。
- **占空比**：在PWM应用中，占空比的调整直接影响输出信号的特性。
- **死区时间**：在使用PWM控制电机时，可能需要考虑添加死区时间以防止短路。

### 输入捕获部分？？？

## 通用定时器输出比较_PWM

- 原理：通过定时器可以控制一个脉冲的 ***\*周期\**** 和 ***\*高电平\**** 的时间,(低电平的时间)

- PWM:波形的周期不变，占空比可以改变

- 占空比：高电平的时间与周期的比（高低电平的时间可以改变）

- 周期  ：一个脉冲的时间（**频率的倒数**） 

- 改变PWM占空比:
  - 连续输出多个脉冲，每个脉冲的周期不变，可以改变高低电平的时间(比较寄存器的值)

- 例子:
  - 计数器装的是数的总个数，也就是总的周期数
  - 频率的倒数，就是一个周期的时间（按照电平来讲，就是一个高低电平的时间）

```
自动重装载寄存器设定一个值   例如1000     //周期

比较寄存器设定一个值      例如500

此时计数器在0到499时，     输出高电平

计数器在500到999时，      输出低电平
```

### 软件生成PWM信号看PWM本质

**PWM就是频率不变的情况下，一段时间输出高电平，一段时间输出低电平但是总的周期不变。重复此操作。那其实其实写一个函数让GPIO口按照规律一段时间持续高电平，一段时间输出低电平，频率对应的周期不变，理论上是不是也能达到这个效果？形成PWM波形？**

理论上来说，你的理解是正确的。通过编写一个函数来控制GPIO口**在固定的时间间隔内交替输出高电平和低电平，确实可以生成一个类似PWM的波形**。以下是这个方法的几个关键点：

1. **定时器**：你需要一个精确的计时机制来确保高电平和低电平的持续时间准确无误。可以使用硬件定时器或软件延迟来实现这个功能。
2. **占空比控制**：通过调整高电平持续的时间和低电平持续的时间的比例，你可以控制所谓的“占空比”，从而模拟PWM的效果。
3. **频率**：通过设定整个周期（高电平+低电平）的总时间，你可以控制PWM信号的频率。
4. **GPIO控制**：你需要使用微控制器的GPIO引脚来输出高低电平。

**然而，这种方法与使用硬件定时器生成PWM相比有一些区别和限制：**

- **精度和稳定性**：硬件定时器提供的PWM**生成通常更精确和稳定**，因为它们是专门为这种任务设计的。软件生成的PWM可能**会因为其他任务的干扰而导致时间不准确**，特别是在多任务环境中。
- **资源消耗**：**使用软件模拟PWM会占用CPU资源，因为微控制器需要不断地进行计时和GPIO控制操作。而硬件PWM几乎不消耗CPU资源。**
- **复杂性**：如果需要多个PWM信号，硬件定时器通常可以轻松处理多个通道，而软件模拟则需要更多的代码和管理。
  - 定时器有多个独立的通道，可以[在频率不变，周期数固定的情况下输出不同的PWM波形](####通道功能的理解)
- **噪声和抖动**：软件生成的PWM信号可能由于定时不精确或中断导致信号抖动或噪声，这在某些应用中可能不理想。

### 定时器驱动IO输出PWM配置寄存器思路

```
配置定时器PWM波输出
CR1：
	7   位         重装载值寄存器影子寄存器使能位     //1
	6:5 位         对齐方式                           //00     边沿对齐方式
	4   位         计数方向                           //0      递增计数
	3   位         计数模式                           //0      连续计数模式
	2: 1 位         允许更新事件，UG位触发            //00
	0   位         使能计数器                         //1      
SMCR
	2:0 位         时钟源选择                         //000     内部时钟源
EGR
	0   位         人为产生更新事件                   //1        UG位人为产生更新事件
CCMRx
	6:4 位          输出形式                          //110       PWM波模式1
  3   位          比较寄存器的影子寄存器使能        //1         使用影子寄存器
	1:0 位          通道模式配置                      //00        选择通道的输出模式
CCER
	3   位          输出比较模式必须为0               //0
	1   位          选择有效电平                      //根据自己需求
	0   位          1 号通道使能                      //1          通道使能       
PSC        
	内部时钟分频                      //直接写
ARR 
	计数总数 一个脉冲的周期          //直接写入
CCRx              
	设置比较值(占空比)               //直接写入
```

**注意：此时影子寄存器全部使能**

预分频器的影子

- **预分频器**（Prescaler）是用来降低定时器时钟频率的计数器。它将输入时钟频率除以一个预分频值来产生定时器的计数时钟。
- **影子预分频器**：有些定时器（特别是高级定时器）支持“影子预分频器”，它允许在不影响当前计数周期的情况下更改预分频值。**这种机制确实有助于保护一个周期内的频率不变**，因为更改预分频器的值不会立即生效，而是等到下一个周期才应用。这避免了在周期中间改变频率，保证了当前周期的完整性。

自动重装载值影子寄存器

- **自动重装载寄存器**（ARR）决定了定时器的计数周期。
- **自动重装载值影子寄存器**：这是一种保护机制，当你改变ARR的值时，新的值不会立即生效，而是存储在一个影子寄存器中。**这个机制保证了在当前周期结束之前，计数器会继续按照原来的ARR值运行**，从而保证了一个周期的完整性。

比较寄存器影子

- **比较寄存器**（CCRx）用于设置PWM信号的占空比。
- **比较寄存器影子**：类似于自动重装载值，比较寄存器也可以有影子机制。**这个影子寄存器确保在当前周期内，PWM信号的占空比不会因为新值的写入而改变**，直到下一个周期开始时才应用新的比较值。这确保了PWM信号在一个周期内的稳定性。

这些影子寄存器的使用主要是为了确保定时器的操作不会在周期中间突然改变，从而避免了可能的计时不准确或信号不稳定。它们提供了一种方式来安全地更新定时器的参数，保证了定时器的可靠性和一致性，尤其是在实时控制或高精度应用中是非常有用的。

### 定时器驱动IO输出PWM波程序设计

```c
总体程序设计
IO控制器配置
通用定时器控制器配置
详细程序设计
初始化配置函数
{
/*IO控制器配置*/
//端口时钟使能
//端口模式配置-------复用模式
//输出类型
//输出速度
//上下拉
//复用功能寄存器
/*通用定时器控制器配置*/
//定时器时钟使能
//CR1
//SMCR
//CCMRx
//CCER
//PSC
//ARR
//CCRx
//EGR
}
```

### PWM波控制LED亮度原理

- 脉冲周期设置为1ms连续输出,可以通过改变周期内的高电平和低电平的时间

- 从而达到灯闪的效果,由于周期1ms，人眼无法分辨出灯闪，就看到不同亮度状态

- 思考:

  - 周期拉过长会出现什么效果    //就会看到闪的效果
    - 周期太长的话，比如1s,高低电平才切换一次，人就能看到闪烁了。

  - 如何改变亮度？         // 比较寄存器的值

- PWM可以驱动IO口的电压值，根据占空比改变而改变

- 说明: 电机调速,彩灯,舵机,屏幕亮度 同理

## 改变占空比影响亮度和转速的本质

1. **PWM（脉宽调制）**：PWM是一种通过改变脉冲宽度来控制模拟电路的技术。在STM32F407上，PWM信号的周期是固定的，但是占空比（即有效电平在整个周期中所占的比例）是可以改变的。
2. **LED亮度控制**：
   - 对于一个低电平有效的LED（即低电平亮，高电平灭），增加低电平的持续时间（即增加占空比），在周期不变的情况下，LED亮的时间就变长了。
   - **原理**：**LED的亮度与通过它的平均电流成正比。PWM通过改变LED亮的时间来改变通过LED的平均电流，从而控制亮度。**
   - **电压的影响**：在PWM控制下，LED的电压实际上是在快速地在高电平（关闭状态）和低电平（亮的状态）之间切换。由于这种切换速度非常快（通常是几千赫兹到几十千赫兹），人眼无法感知到这种闪烁，**而是感知到一个平均亮度**。因此，**实际上是通过改变低电平的持续时间来控制LED的有效电压，从而控制亮度。**
3. **电机转速控制**：
   - 对于电机来说，PWM信号的占空比直接影响了电机的平均供电电压。更高的占空比意味着电机在每个周期内获得更长时间的高电平，从而获得更多的能量，导致转速增加。
   - **前提是高电平驱动电机**
   - **同样地，电机的转速与通过电机的平均电流（或平均电压）相关，PWM通过改变高电平的持续时间来控制这个平均电压，从而调节转速。**

**总结**：

- 增加低电平持续时间（增加占空比）确实会增加LED的亮度，因为它增加了LED亮的时间，从而增加了通过LED的平均电流。
- 这个过程本质上是通过改变电压的有效值来实现的。PWM信号的频率足够高时，LED或电机看到的是一个平均电压，这个平均电压决定了它们的表现（亮度或转速）。

需要注意的是，PWM的频率选择也非常重要。对于LED，通常选择高于人眼能感知的频率（一般在100Hz以上）以避免闪烁。而对于电机，PWM频率的选择需要考虑到电机的特性，避免引起不必要的噪音或效率损失。



**所以对于LED来说的话，只要频率不变，人依旧看不到灯的闪烁，但是可以改变占空比人可以看到亮度的变化，但是依旧看不到灯的闪烁，除非频率非常慢**

- **周期不变的情况下**，如果我们增加低电平的持续时间（即LED亮的时间），那么高电平的持续时间（即LED灭的时间）必然会相应减少，因为整个周期的长度是固定的。

- **频率足够高时**，人眼无法分辨出LED的闪烁。假设你说的周期是1000微秒（即频率为1kHz），前900微秒是低电平（LED亮），后100微秒是高电平（LED灭）。由于频率足够高（1kHz或更高），人眼会将这些快速的闪烁平均化，感知到的是一个稳定的亮度。

- **如果频率降低到人眼能感知的范围内**，例如降低到10Hz（即周期为100毫秒），这时如果你保持同样的占空比（例如90%的周期为低电平），你会看到LED亮的时间明显比灭的时间长。在这个频率下，人眼能够感知到LED的闪烁，并且会注意到亮的时间更长。

- **频率与占空比的关系**：

  - 频率决定了闪烁的速度。
  - 占空比决定了在每个周期内，LED亮的时间占比。

  当频率足够高时，人眼将占空比视为亮度，而当频率降低到人眼能感知闪烁时，占空比的变化会直接影响到LED亮灭的时长感知。

因此，在你描述的情景下：

- 周期不变，频率也不变，增加低电平的持续时间会使LED看起来更亮。
- 如果频率降低到人眼能感知闪烁的范围，LED的亮灭周期会变得明显，占空比的变化会直接影响到LED亮的时间和灭的时间的比例。

### 本质上影响电压

让我们详细探讨一下PWM如何影响LED亮度和电机转速：

#### LED亮度

- **占空比**：对于LED，PWM通过改变占空比来控制亮度。占空比指的是在一个周期内高电平（或低电平，视LED的有效电平而定）持续的时间比例。
  - 如果LED是低电平有效（低电平亮），增加有效电平（低电平）的持续时间，即降低占空比，会增加LED的亮度。
  - 如果LED是高电平有效（高电平亮），增加有效电平（高电平）的持续时间，即增加占空比，会增加LED的亮度。
- **电压影响**：本质上，PWM控制LED亮度是通过改变LED上的平均电压来实现的。频率足够高时，LED接收到的是一个平均电压，这个电压由占空比决定：
  - **低电平有效**：更低的占空比（更长的低电平时间）意味着LED获得更高的平均电压，导致更亮。
  - **高电平有效**：更高的占空比（更长的高电平时间）意味着LED获得更高的平均电压，导致更亮。

#### 电机转速

- **占空比**：对于电机，PWM通过改变占空比来控制电机的平均供电电压，从而控制转速。
  - 增加占空比（更长时间的高电平）会提供给电机更高的平均电压，增加转速。
  - 降低占空比（更短时间的高电平）会减少提供给电机的平均电压，减慢转速。
- **电压影响**：电机的转速直接受到供电电压的影响。PWM信号的高电平时间越长，电机接收到的平均电压就越高，转速就越快。

#### 总结

- **占空比**决定了在每个周期内，LED或电机**接收到有效电平的时间比例。**
- **频率足够高时**，人眼无法察觉到PWM信号的变化，LED和电机接收到的实际上是一个平均电压。
- **有效电平的持续时间会影响到这个平均电压**：
  - **对于低电平有效的LED，增加低电平的持续时间会增加平均电压**，增亮LED。
  - **对于高电平有效的LED或电机，增加高电平的持续时间会增加平均电压**，增亮LED或加快电机转速。

因此，PWM通过调节占空比来控制平均电压，从而影响LED的亮度和电机的转速。这里的"有效电平"指的是驱动LED或电机所需的电平，而非单纯的高电平或低电平。

**一句话：在周期和频率不变的情况下，驱动外设的有效电平持续时间越长，外设获得的平均电压越高，效果（如LED亮度或电机转速）就越强。有效电平的持续时间与平均电压的关系取决于外设的特性，而不是单纯的高电平持续时间**：

- **对于低电平有效的外设**（如一些LED），低电平持续时间越长，平均电压越高，效果越强。
- **对于高电平有效的外设**（如一些电机或其他LED），高电平持续时间越长，平均电压越高，效果越强。

因此，**关键在于有效电平的持续时间**，而不是简单地认为高电平时间越长平均电压就越高。谢谢你指出了这一点，使得解释更加准确。

## GPIO口给低电平LED常亮与GPIO口给PWM波形LED常亮的本质区别

### GPIO口给低电平使LED常亮

1. **电平持续性**：
   - LED的亮灭状态**直接**由GPIO引脚的电平决定。如果LED是低电平有效（即阴极连接到GPIO引脚，阳极连接到电源正极），那么当GPIO设置为低电平时，LED就会亮起。反之，如果是高电平有效，GPIO设置为高电平时，LED会亮。
2. **电流回路**：
   - 由于GPIO引脚**持续保持在低电平**（或高电平），LED形成一个**完整的电流回路**，因此LED会持续发光。
3. **亮度控制**：
   - **这种方法不提供亮度调节，除非通过改变电流或电压来手动调整亮度。**
4. **频率无关**：
   - **亮灯状态与频率无关，因为LED不是在闪烁，而是持续亮着。**

### GPIO口给PWM波形使LED看起来常亮

1. **脉冲调制**：
   - PWM（脉宽调制）通过快速切换GPIO引脚的高低电平来实现。即使LED在理论上是断续的，但由于频率很高（通常大于50Hz），人眼无法察觉到闪烁。
2. **占空比**：
   - 通过调整PWM的占空比，可以精确控制LED的亮度。占空比是指在一个周期内高电平持续的时间比例。100%的占空比等同于持续的低电平，LED会全亮；0%则LED不亮；在0%到100%之间，LED的亮度随占空比变化。
   - **占空比**是指高电平在整个周期中所占的比例，而非低电平的比例。在描述PWM控制LED亮度时，必须明确LED的有效电平（高电平或低电平）来正确理解占空比的影响。
3. **电流回路的间断性**：
   - 在PWM模式下，LED的电流回路是断续的，但由于频率很高，电流的平均值可以看作是恒定值，因此LED看起来是持续亮着的。
4. **频率的作用**：
   - PWM的频率对LED的视觉效果有影响。如果频率太低，LED会闪烁；如果频率足够高，LED看起来会像常亮。

### 总结

- 本质区别：
  - **持续电平 vs. 脉冲调制**：前者是持续提供电平，形成恒定的电流回路；后者是通过快速切换高低电平来模拟持续亮灯，但实际上是断续的。
  - **控制精细度**：PWM提供更细腻的控制，可以调整亮度，而直接设置电平只能让LED全亮或全灭。
  - **应用场景**：直接设置电平适合简单的开关控制，而PWM适用于需要调光或节能的应用。

两者虽然在视觉效果上可能相似，但在实现机制、控制能力和应用场景上存在显著区别。

