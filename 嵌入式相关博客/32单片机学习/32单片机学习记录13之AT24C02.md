# 32单片机学习记录13之AT24C02

看说明书的思路：

- 看特点

- 看引脚

- 如何操作
  - 如何跟主控芯片进行数据交换

## AT24C02介绍

### 常见的存储设备存储类型

​	Rom   ：只读存储器  ：     CD碟----掉电不丢失

​	Ram   ：随机存储器(可读可写)，掉电数据丢失，读写速度快， 内存条

​	Eeprom ：可读可写，掉电数据不丢失，  电可擦除PROM,   AT24Cxx    IIC

​	Flash  ：闪存，可读可写，掉电数据不丢失  手动擦除     W25Q64   SPI



### AT24C02特点

- at24c02是一种EEPROM存储芯片
- 工作电压范围 1.8~5.5v	（工作电压范围宽）
- 支持低功耗模式（待机）
- 存储容量 256 * 8 （2k bit）   //256 byte

  - 256 : 寻址空间  绝对地址0 ~ 255        8  ：页

  - AT24C02有256个存储空间，每个存储空间可以存一个字节（8bit）数据	  
- 2线串行接口，兼容IIC总线接口（IIC通信）  
  - IIC总线通信速度(3.3v)	
- 硬件数据写保护
  - 把数据写进去，可以通过写保护管脚接入相应的电平时候，**只能读不能写**
- 内部写周期最大5ms	
  - **当写数据时候，他先将数据存在存储器中，把相应地址空间的数据清除，然后才会把数据写到对应地址中。要给5ms的时间**
- 可按字节写，也可以按页写

  - 按字节写：对应的找到地址空间，写入数据
- 按页写  ：一页8字节，可以自动写下一个字节但是不能自动换页
  
  - 自动找页内下一个地址，只需要给首地址即可
    - 越界会从头回写覆盖
    - **页写概念**：虽然AT24C02的存储器没有真正的“页”的物理分区，但为了提高写入效率，引入了“页写”的概念。页写允许你一次性写入多个字节的数据。
    - **自动地址递增**：
      - 在开始写入操作时，你需要提供一个起始地址。AT24C02会自动将后续的字节写入到这个起始地址之后的地址。
      - 写入的字节数不超过8个时，地址会自动递增。在AT24C02中，每页的容量是8字节。
    - **限制**：
      - 如果你试图写入超过8个字节的数据，AT24C02不会自动继续写入到下一页。相反，超过8个字节的写入将不会被处理或会导致错误。
      - 当写入操作超过8个字节时，你需要手动管理地址，确保你不超出页面边界或者在需要时手动跳转到下一页的起始地址。
    - **使用建议**：
      - 为了确保写入操作的成功，最好将每次写入的数据量限制在8个字节以内。
      - 如果需要写入超过8个字节的数据，你可以分批次进行，每次写入不超过8个字节，并手动调整地址。
  - 起始地址编号   和   内容 
- 读是没有限定的可以从0地址空间读到255地址空间（自动地址递增）
- 可擦写100万次。（注意：跟读没关系）

### 引脚说明

- Vcc： 电源

- GND： 地

- A0,A1,A2 ： 器件地址位

  - 此器件地址： 1 0 1 0 A2 A1 A0 R/W  （手册8页）---前四位固定，后三位自由设置，最后一位为读写控制位 （1：主机读AT24的数据  0:主机写数据到AT24）

  - 根据原理图可知：A2 A1 A0 接地  

  - 所以器件地址为： 1 0 1 0 0 0 0 R/W    写：10100000(0xa0)   读：10100001(0xa1)  
  - 0xa0：写模式      0xa1：读模式

- SDA： IIC通信的数据线

- SCL： IIC通信的时钟线

- WP： 写保护管脚，接地可以正常读写，高电平只能读	

**对AT24C02读写操作**

- AT24C02器件地址 1010000(读/写)位    

- 读写位：

  - 接下来ST32要对存储芯片的读写操作

  - 写： 0         10100000    0xa0

  - 读： 1         10100001    0xa1



### 页边界的确定

- **没有物理上的页**：是的，我之前提到 AT24C02 等 EEPROM 设备在物理结构上并没有真正的"页"。它们是连续的存储单元，每个单元通常是1个字节。
- **逻辑上的页**：尽管物理上没有页的概念，但在EEPROM的操作上，为了提高写入效率和简化控制逻辑，制造商引入了"页写"的概念。**页写**允许一次写入多个字节，**这实际上是通过硬件或固件实现的批量写入机制。**
- **页边界**：虽然物理上没有页的结构，但是为了方便和优化写入操作，EEPROM 的设计者定义了一个逻辑上的页大小（例如，AT24C02 定义为8字节）。这个逻辑上的页大小决定了页边界：
  - 当您执行页写操作时，EEPROM 控制器会检查写入的字节数和起始地址，确保写入操作不会超过定义的页边界。
  - 如果写入操作会跨越这个逻辑页边界，控制器会停止写入，并需要您重新发起一个新的写入操作来处理剩余的数据。

**为什么默认页的边界？**

- **写入效率**：页写可以提高写入效率，因为它减少了发送起始和停止信号的次数以及地址设置的次数。
- **简化控制逻辑**：**通过定义页边界，EEPROM 的控制逻辑可以更简单地管理写入操作，避免因连续写入而导致的过度复杂的控制。**
- **兼容性和一致性**：**定义一个固定的页大小和边界有助于保持不同 EEPROM 设备之间的兼容性和操作的一致性。**

因此，虽然 EEPROM 在物理上没有页的概念，但为了操作上的便利和效率，制造商和设计者引入了逻辑上的页边界概念。这意味着在编程时，您必须考虑到这些逻辑上的边界，以确保数据写入的正确性和完整性。

**页边界的固定性**：

- 对于 AT24C02 这样的 EEPROM，页的大小是固定的（8个字节），这意味着每个页的边界也是固定的。页边界是由地址的低三位决定的，无论首地址是多少。

**如何确定页边界**：

- 页的边界不是根据传入的首地址动态计算的，而是由EEPROM的设计预先定义好的。无论您从哪个地址开始写入，页的边界都是固定的。
- 例如，地址 `0x00` 到 `0x07` 始终属于第一页，`0x08` 到 `0x0F` 属于第二页，以此类推。

**写入操作的限制**：

- 当您进行页写操作时，EEPROM 控制器会检查您试图写入的数据是否会跨越这些固定边界。如果会，控制器会只允许写入到页边界，然后您需要重新发起一个新的写入操作来写入剩余的数据。
- 如果超过8个（ 24C02）或16个（ 24C04/08/16）或32个（ 24C32/64）数据传送给了EEPROM，字地址将回转到**该页的首字节**，先前的字节将会被覆盖 。

**为什么不能动态计算页边界？**

- **硬件设计**：EEPROM 的硬件设计通常是基于固定页大小的，这简化了控制逻辑和提高了写入效率。
- **操作一致性**：固定页边界确保了操作的一致性和可预测性，不论首地址是什么。
- **简化软件开发**：固定页边界使得软件开发者在编写 EEPROM 操作代码时可以更容易地管理写入和读取操作。

因此，虽然首地址会影响您开始写入的页，但页边界本身是固定的，您需要根据这些固定的边界来调整您的写入操作。如果您的写入操作会跨页，您需要手动处理剩余的数据写入，确保不跨越页边界或正确处理跨页情况。