# 32单片机学习记录15之W25Q64

## 前置

**其实学习IIC协议和SPI通信协议，只是明白发送原理，规则。具体怎么利用协议通信还是要看对应硬件对吗？比如AT24C02或者W25Q64?比如学习IIC时，说明发送一个字节需要起始信号，数据传输段，结束信号。但是具体到AT24C02时，发送一个字节需要起始信号，数据传输段具体分成了：发送器件地址，发送内部地址，发送数据。结束信号。实现上会有不同，但是底层原理不变**

IIC协议的基本原理和时序图是通用的，但当应用到具体的设备时，具体的操作步骤会根据设备的功能和设计而有所不同。让我们详细看一下AT24C02的情况：

**IIC协议的通用步骤：**

1. **起始信号（Start Condition）**：SDA线在SCL线为高电平时从高到低的跳变。
2. **数据传输段**：在SCL线的高电平期间，SDA线上的数据有效。
3. **应答位（ACK/NACK）**：每个字节传输后，接收方会发送一个应答信号。
4. **结束信号（Stop Condition）**：SDA线在SCL线为高电平时从低到高的跳变。

**AT24C02的具体实现：**

- **起始信号**：和IIC协议一致。
- 数据传输段：
  - **发送器件地址**：AT24C02有7位的器件地址，加上第8位的读写位（R/W）。例如，AT24C02的器件地址通常是`1010`（A2A1A0），加上读写位形成一个字节的地址。
  - **发送内部地址**：在写操作时，紧接着发送一个字节的内部地址（AT24C02有256字节存储空间，所以地址是8位）。
  - **发送数据**：发送实际的数据字节。每个字节后，设备会发送一个ACK。
- **结束信号**：和IIC协议一致。

这里的差异主要体现在：

- **地址和数据的组织**：AT24C02需要明确的器件地址和内部地址来指定要操作的存储位置。
- **操作的顺序**：必须按照器件地址、内部地址、数据的顺序发送数据。
- **命令集**：尽管IIC协议没有明确的“命令集”，但AT24C02在操作上可以看作是通过发送特定格式的数据来执行命令。

因此，虽然底层协议的原理不变，但具体到不同的设备时，如何利用这些协议来进行实际的读写操作会有不同的细节需要注意。这就是为什么在学习IIC或SPI等协议时，还需要深入了解具体硬件的使用手册和特性。

## 最小示例

**我准备使用W25Q64,我已经配置了SPI控制器，编写了收发一个字节的一体函数，我该怎么往W25Q64中存数据？以及取数据？写一个最小示例使用C语言**

基本流程

**初始化 SPI**

确保已经正确初始化 SPI 接口，并且能够正常发送和接收数据。

**写数据流程**

- **写使能 (Write Enable)**：在写入数据之前，必须发送 `W25Q64_WRITE_ENABLE` 指令 (0x06)。
- **擦除扇区 (Sector Erase)**：写入前需要擦除对应的扇区 (64KB, 32KB, 或 4KB)。
- **写数据**：使用 `W25Q64_PAGE_PROGRAM` 指令 (0x02) 写入数据。注意单次写操作的最大数据量为 256 字节（1页）。

**读取数据流程**

- **发送读取指令**：使用 `W25Q64_READ_DATA` 指令 (0x03)。
- **发送地址**：指定从哪个地址开始读取。
- **接收数据**：读取所需的数据长度。

**等待设备就绪**

通过读取状态寄存器 (指令 0x05)，判断是否写入完成。



